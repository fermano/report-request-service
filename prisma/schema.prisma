generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ReportType {
  SALES_SUMMARY
  USER_EXPORT
  INVENTORY_SNAPSHOT
}

enum ReportStatus {
  DRAFT
  QUEUED
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}

model ReportRequest {
  id             String       @id @default(uuid()) @db.Uuid
  title          String
  type           ReportType
  parameters     Json
  status         ReportStatus  @default(DRAFT)
  createdBy      String
  idempotencyKey String?
  version        Int          @default(1)
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  deletedAt      DateTime?
  completedAt    DateTime?
  failureReason  String?
}

model IdempotencyKey {
  key          String
  route        String
  requestHash  String
  responseCode Int
  responseBody Json
  createdAt    DateTime @default(now())

  @@id([key, route])
}
